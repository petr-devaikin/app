<!doctype html>
<html>
  <head>
    <title>Advanced Programming Project</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script type="text/javascript" src='/javascripts/vendor/jquery-1.11.2.js'></script>
    <style>
      #topleft{
        position:fixed;
        top:0 !important;
        left:0 !important;
        z-index: 999;
        width: 100px;
      }
      
      #topright{
        position: fixed;
        top: 0 !important;
        right: 0 !important;
        z-index: 999;
        width: 100px;
      }
      
      #bottomleft{
        position: fixed;
        bottom: 0 !important;
        left: 0 !important;
        z-index: 999;
        width: 100px;
      }
      
      #bottomright{
        position: fixed;
        bottom: 0 !important;
        right: 0 !important;
        z-index: 999;
        width: 100px;
      }
      .maindiv{
        width:295cm;
        height:210cm;
        position:fixed;
        top:0;
        left:0;
        z-index:99;
        display: none;
      }
    </style>
  </head>
  <body onload="init()">
    
    <div class="maindiv" id="mainDiv">
      
    </div>
    <canvas id="can"  style="cursor:pointer; position:fixed; top:0; left:0;"></canvas>
      <img src="/images/topleft.png" id="topleft"/>
      <img src="/images/topright.png" id="topright"/>
      <img src="/images/bottomleft.png" id="bottomleft"/>
      <img src="/images/bottomright.png" id="bottomright"/>
    
    
    
    
    <img id="canvasimg" style="width:100%; height:100%" style="display:none;">
    
    <script type="text/javascript">
      var canvas, ctx, flag = false,
          prevX = 0,
          currX = 0,
          prevY = 0,
          currY = 0,
          dot_flag = false;
      
      var x = "black",
          y = 2;
      
      function init() {
          canvas = document.getElementById('can');
          ctx = canvas.getContext("2d");
          var maindiv = document.getElementById("mainDiv");
          ctx.canvas.width  = window.innerWidth;
          ctx.canvas.height = window.innerHeight;
          w = canvas.width;
          h = canvas.height;
      
          canvas.addEventListener("mousemove", function (e) {
              findxy('move', e)
          }, false);
          canvas.addEventListener("mousedown", function (e) {
              findxy('down', e)
          }, false);
          canvas.addEventListener("mouseup", function (e) {
              findxy('up', e)
          }, false);
          canvas.addEventListener("mouseout", function (e) {
              findxy('out', e)
          }, false);
      }
      
      function color(obj) {
          switch (obj.id) {
              case "green":
                  x = "green";
                  break;
              case "blue":
                  x = "blue";
                  break;
              case "red":
                  x = "red";
                  break;
              case "yellow":
                  x = "yellow";
                  break;
              case "orange":
                  x = "orange";
                  break;
              case "black":
                  x = "black";
                  break;
              case "white":
                  x = "white";
                  break;
          }
          if (x == "white") y = 14;
          else y = 2;
      
      }
      
      function draw() {
          ctx.beginPath();
          ctx.moveTo(prevX, prevY);
          ctx.lineTo(currX, currY);
          ctx.strokeStyle = x;
          ctx.lineWidth = y;
          ctx.stroke();
          ctx.closePath();
      }
      
      function findxy(res, e) {
          if (res == 'down') {
              prevX = currX;
              prevY = currY;
              currX = e.clientX - canvas.offsetLeft;
              currY = e.clientY - canvas.offsetTop;
      
              flag = true;
              dot_flag = true;
              if (dot_flag) {
                  ctx.beginPath();
                  ctx.fillStyle = x;
                  ctx.fillRect(currX, currY, 2, 2);
                  ctx.closePath();
                  dot_flag = false;
              }
          }
          if (res == 'up' || res == "out") {
              flag = false;
          }
          if (res == 'move') {
              if (flag) {
                  prevX = currX;
                  prevY = currY;
                  currX = e.clientX - canvas.offsetLeft;
                  currY = e.clientY - canvas.offsetTop;
                  draw();
              }
          }
      }
      
      $(document).ready(function(){
        var URL = window.location.hostname;
        
        setInterval(function(){ 
           $.ajax({
            Method:"GET",
            url: "http://"+URL+":3000/gesture",
            success: function(result){
              if(result != "idle"){
                var obj = jQuery.parseJSON(result);
                ctx.fillRect(obj.x,obj.y,3,3);
                //ctx.strokeText(result, 20, 30);
              }
            },
            error: function(){
              var c = document.getElementById('can');
              var ctx = c.getContext("2d");
              ctx.font = "30px Arial";
              ctx.strokeText("Error",10,50);
              ctx.strokeText("404", 20, 30);
            }
          });
        }, 100);
      });
      </script>
  </body>
</html>
